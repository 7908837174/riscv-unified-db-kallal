# Copyright (c) 2025 Kallal Mukherjee
# SPDX-License-Identifier: BSD-3-Clause-Clear

# yaml-language-server: $schema=../../../schemas/csr_schema.json

$schema: "csr_schema.json#"
kind: csr
name: stopi
long_name: Supervisor Top Interrupt Pending
address: 0x15B
priv_mode: S
length: MXLEN
writable: false
description: |
  A read of stopi returns zero either if no interrupt is both pending and
  enabled, or if no pending-and-enabled interrupt has an identity number less
  than the value of stimecmp. Otherwise, the value returned has this format:

  bits 26:16 Interrupt identity
  bits 10:0 Interrupt priority (same as identity)
  All other bit positions are zeros.
definedBy: Ssaia
fields:
  IID:
    location: 26-16
    long_name: Interrupt ID
    description: |
      Interrupt identity.
    type: RO
    reset_value: 0
    definedBy: Ssaia
  IP:
    location: 10-0
    long_name: Interrupt Priority
    description: |
      Interrupt priority (same as identity).
    type: RO
    reset_value: 0
    definedBy: Ssaia
sw_read(): |
  // Return the top pending interrupt
  if (!implemented?(ExtensionName::Ssaia)) {
    return 0;
  }
  // Implementation would return the top pending interrupt
  // This is a placeholder - actual implementation would depend on interrupt tracking
  return 0;