# yaml-language-server: $schema=../../schemas/csr_schema.json

mcounteren:
  long_name: Machine Counter Enable
  address: 0x306
  priv_mode: M
  length: 32
  description: |
    Delegates control of the hardware performance-monitoring counters
    to the next-lowest privileged mode
  definedBy: U # actually, defined by RV64, but must implement U-mode for this CSR to exist
  fields:
    CY:
      location: 0
      description: |
        When set, the `cycle` CSR (an alias of `mcycle`) is accessible to
        <%- if ext?(:S) -%>
        S-mode.
        <%- else -%>
        U-mode.
        <%- end -%>

        <%- if ext?(:S) -%>
        When `scounteren.CY` is also set, `cycle` is futher accessible to U-mode.
        <%- end -%>
      type: RW
      reset_value: UNDEFINED_LEGAL
    TM:
      location: 1
      description: |
        When set, the `time` CSR (an alias of memory-mapped `mtime`) is accessible to
        <%- if ext?(:S) -%>
        S-mode.
        <%- else -%>
        U-mode.
        <%- end -%>

        <%- if ext?(:S) -%>
        When `scounteren.TM` is also set, `time` is futher accessible to U-mode.
        <%- end -%>
      type: RW
      reset_value: UNDEFINED_LEGAL
    IR:
      location: 2
      description: |
        When set, the `instret` CSR (an alias of memory-mapped `minstret`) is accessible to
        <%- if ext?(:S) -%>
        S-mode.
        <%- else -%>
        U-mode.
        <%- end -%>

        <%- if ext?(:S) -%>
        When `scounteren.IR` is also set, `instret` is futher accessible to U-mode.
        <%- end -%>
      type: RW
      reset_value: UNDEFINED_LEGAL
    <%- NUM_HPM_COUNTERS.times do |hpm_num| -%>
    HPM<%= hpm_num + 3 %>:
      location: <%= 3 + hpm_num %>
      description: |
        When set, the `hpmcounter<%= 3 + hpm_num %>` CSR (an alias of `mhpmcounter<%= 3 + hpm_num %>`) is accessible to
        <%- if ext?(:S) -%>
        S-mode.
        <%- else -%>
        U-mode.
        <%- end -%>

        <%- if ext?(:S) -%>
        When `scounteren.HPM<%= hpm_num + 3 %>` is also set, `hpmcounter<%= 3 + hpm_num %>` is futher accessible to U-mode.
        <%- end -%>
      type: RW
      reset_value: UNDEFINED_LEGAL
    <%- end -%>
